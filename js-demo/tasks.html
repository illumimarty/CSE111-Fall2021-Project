<!DOCTYPE html>
<html> 

<head>
    <meta charset="utf-8">
    <title>Tasks Database</title>

   <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

   <script>
      function populateBoards() {
         var selBoard = document.getElementById('board');

         const API_URL = 'http://127.0.0.1:8092/boards';
         axios.get(`${API_URL}`)
            .then(response => {
               //console.log(response.data.data);
               
               for (x=0; x<response.data.data.length; x++) {
                  //console.log(response.data.data[x].Title);

                  option = document.createElement('option');
                  option.value = response.data.data[x].Title;
                  option.text = response.data.data[x].Title;
                  selBoard.appendChild(option);
               }
            })
            .catch(error =>
               console.error('populateBoards', error)
            )
      }

      function insertBoard() {
         var boardTitle = document.getElementById('boardName').value;
         console.log(boardTitle);

         const API_URL = `http://127.0.0.1:8092/api/${boardTitle}/`;
         axios.get(`${API_URL}`)
            .then(response => {
               console.log("Success!")
            })
            .catch(error =>
               console.error('insertBoard', error)
            )
      }

      function insertTask() {
         var taskTitle = document.getElementById('taskTitle').value;
         var taskDueDate= document.getElementById('taskDueDate').value;
         var taskDetails = document.getElementById('taskDetails').value;
         // console.log(boardTitle);

         const API_URL = `http://127.0.0.1:8092/api/designtask/${taskTitle}-${taskDueDate}-${taskDetails}`;
         axios.post(`${API_URL}`)
            .then(response => {
               // console.log("Success!")
               console.log(response.data)
            })
            .catch(error =>
               console.error('insertBoard', error)
            )
      }

      function runQuery() {
         var selBoard = document.getElementById('board').value;
         console.log(selBoard);

         var result = document.getElementById('result');
         result.innerHTML = "";

         const API_URL = `http://127.0.0.1:8092/boards/${selBoard}`;
         axios.get(`${API_URL}`)
            .then(response => {
               //console.log(response.data.data);

               if (response.data.data.length == 0) {
                  return;
               }

               let thead = result.createTHead();
               let row = thead.insertRow();
               for (key in response.data.data[0]) {
                  //console.log(key);

                  let th = document.createElement("th");
                  let text = document.createTextNode(key);
                  th.appendChild(text);
                  row.appendChild(th);
               }
               
               for (x=0; x<response.data.data.length; x++) {
                  console.log(response.data.data[x].board);

                  let row = result.insertRow();
                  for (k in response.data.data[x]) {
                     console.log(k);

                     let cell = row.insertCell();
                     let text = document.createTextNode(response.data.data[x][k]);
                     cell.appendChild(text);
                  }
               }
            })
            .catch(error =>
               console.error('runQuery', error)
            )
      }
   </script>
</head>
    
<body onload="populateBoards()">
   <label>Board:</label>
   <select name="board" id="board">
      <option value=''>------- Select --------</option>
      <option value='All'>All</option>
   </select>

   <button name="runQ" onclick="runQuery()">Find</button>

   <br><br>

   <!-- <label>Insert New Board:</label><br>
   <label>Title:</label>
   <input type="text" id="boardName" name="boardName">

   <button name="insertTup" onclick="insertBoard()">Add</button> -->

   <label>Insert New Task:</label><br>
   <label>Title:</label><input type="text" id="taskTitle" name="taskTitle"><br>
   <label>DueDate:</label><input type="text" id="taskDueDate" name="taskDueDate"><br>
   <label>Details:</label><input type="text" id="taskDetails" name="taskDetails"><br>

   <button name="insertDesignTask" onclick="insertTask()">Add</button>


   <br><br><br>

   <table name="result" id="result"></table>
</body>

</html>
